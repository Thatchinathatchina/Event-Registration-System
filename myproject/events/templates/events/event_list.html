{% extends "events/base.html" %}
{% block content %}
<h1 class="text-danger">Events</h1>

<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <input name="q" value="{{ q }}" class="form-control" placeholder="Search event name">
  </div>
  <div class="col-md-2">
    <select name="status" class="form-select">
      <option value="upcoming" {% if status == 'upcoming' %}selected{% endif %}>Upcoming</option>
      <option value="past" {% if status == 'past' %}selected{% endif %}>Past</option>
      <option value="all" {% if status == 'all' %}selected{% endif %}>All</option>
    </select>
  </div>
  <div class="col-md-2">
    <select name="cancelled" class="form-select">
      <option value="" {% if not cancelled %}selected{% endif %}>All</option>
      <option value="0" {% if cancelled == '0' %}selected{% endif %}>Not cancelled</option>
      <option value="1" {% if cancelled == '1' %}selected{% endif %}>Cancelled</option>
    </select>
  </div>
  <div class="col-md-2">
    <select name="sort" class="form-select">
      <option value="start_time" {% if sort == 'start_time' %}selected{% endif %}>Date ↑</option>
      <option value="-start_time" {% if sort == '-start_time' %}selected{% endif %}>Date ↓</option>
      <option value="name" {% if sort == 'name' %}selected{% endif %}>Name ↑</option>
      <option value="-name" {% if sort == '-name' %}selected{% endif %}>Name ↓</option>
      <option value="-capacity" {% if sort == '-capacity' %}selected{% endif %}>Capacity ↓</option>
    </select>
  </div>
  <div class="col-md-2">
    <button class="btn btn-primary">Apply</button>
  </div>
</form>

<div class="list-group">
  {% for event in events %}
    <a class="list-group-item list-group-item-action" href="{% url 'events:detail' event.pk %}">
      <div class="d-flex w-100 justify-content-between">
        <h5 class="mb-1">{{ event.name }}</h5>
        <small>{{ event.start_time|date:"Y-m-d H:i" }}</small>
      </div>
      <p class="mb-1">{{ event.description|truncatechars:120 }}</p>
      <small>Capacity: {{ event.capacity }} • Registered: {{ event.registrations_count }} • Seats left: {{ event.seats_left }} {% if event.cancelled %}• <span class="text-danger">CANCELLED</span>{% endif %}</small>
    </a>
  {% empty %}
    <div class="alert alert-info">No events found.</div>
  {% endfor %}
</div>

<nav aria-label="Page navigation" class="mt-3">
  <ul class="pagination">
    {% if events.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ events.previous_page_number }}">&laquo; prev</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Page {{ events.number }} of {{ events.paginator.num_pages }}</span></li>
    {% if events.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ events.next_page_number }}">next &raquo;</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
